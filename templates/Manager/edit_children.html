{% extends 'Manager/manager_index.html' %}
{% block main %}
    {% load filters %}
    <div class="wrapper wrapper-content animated fadeInRight">
                <div class="row">
                    <div class="col-lg-12">
                         <div class="ibox ">
                    <div class="ibox-title">
                        <h5>Children under your supervise</h5>
                        <div class="ibox-tools">
                            <a class="collapse-link">
                                <i class="fa fa-chevron-up"></i>
                            </a>
                            <a class="close-link">
                                <i class="fa fa-times"></i>
                            </a>
                        </div>
                    </div>
                    <div class="ibox-content">

                        <div class="table-responsive">
                    <table class="table table-striped table-bordered table-hover dataTables-example" >
                    <thead>
                    <tr>
                        <th>编号</th>
                        <th>姓名</th>
                        <th>性别</th>
                        <th>年龄</th>
                        <th>学历</th>
                        <th>入院时间</th>
                        <th>体重</th>
                        <th>身高</th>
                        <th>体温</th>
                        <th>右眼视力</th>
                        <th>左眼视力</th>
                        <th>是否被领养</th>
                        <th>操作</th>
                    </tr>
                    </thead>
                        <tbody>
                        {% for item in res %}
                            <tr>
                                <td>{{ item.num }}</td>
                                <td>{{ item.name }}</td>
                                <td>{{ item.gender }}</td>
                                <td>{{ item.age }}</td>
                                <td>{{ item.edu }}</td>
                                <td>{{ item.enter_time }}</td>
                                <td>{{ item.weight }}</td>
                                <td>{{ item.height }}</td>
                                {% if item.temperature >= 37.5 %}
                                <td style="color:red;">{{ item.temperature }}</td>
                                {% else %}
                                <td>{{ item.temperature }}</td>
                                {% endif %}
                                <td>{{ item.right_sight }}</td>
                                <td>{{ item.left_sight }}</td>
                                {% if item.Is_adopted == True %}

                                    <td style="color: green">被领养</td>
                                   {% else %}
                                    <td style="color: gray">未被领养</td>
                                {% endif %}
                                <td>
                                    <a id="startmodal" data-toggle="modal" data-target="#Modal" href="#"
                                        onclick="values('{{ item.num }}','{{ item.name }}','{{ item.enter_time }}','{{ item.age }}','{{ item.edu }}','{{ item.height }}'
                                                ,'{{ item.weight }}','{{ item.right_sight }}','{{ item.left_sight }}','{{ item.temperature }}','{{ item.gender }}','{{ item.Is_adopted }}')">修改</a>

                                    <div class="modal fade" id="Modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">修改成绩</h5>
                                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                          <span aria-hidden="true">&times;</span>
                                                        </button>
                                                </div>
                                                <div class="modal-body">
                                                    <div class="row">
                                                        <div class="col-md-11 order-md-1 offset-md-1">
                                                            <div class="row">
                                                                <div class="col-md-3">
                                                                    <label for="lastName">儿童编号</label>
                                                                    <input disabled="" name="num" type="text" class="form-control" id="num" value="{{ item.num }}" required="">
                                                                    <div class="invalid-feedback">
                                                                        Valid Name is required.
                                                                    </div>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <label for="lastName">姓名</label>
                                                                    <input  name="name" type="text" class="form-control" id="name" value="{{ item.name }}" required="">
                                                                    <div class="invalid-feedback">
                                                                         Valid Name is required.
                                                                     </div>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <label for="lastName">性别</label>
                                                                    <input  name="gender" type="text" class="form-control" id="gender" value="{{ item.gender }}" required="">
                                                                    <div class="invalid-feedback">
                                                                         Valid Name is required.
                                                                     </div>
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-top: 10px">
                                                                <div class="col-lg-5">
                                                                    <label>入院时间</label>
                                                                    <input  name="enter_time" type="text" class="form-control" id="enter_time" value="{{ item.enter_time }}" required="">
                                                                    <div class="invalid-feedback">
                                                                        Valid Name is required.
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-5">
                                                                    <label for="lastName">是否被领养(输入y或n）</label>
                                                                    <input  name="Is_adopted" type="text" class="form-control" id="Is_adopted" value="{{ item.Is_adopted }}" required="">
                                                                    <div class="invalid-feedback">
                                                                         Valid Name is required.
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-top: 10px">
                                                                <div class="col-lg-5">
                                                                    <label>年龄</label>
                                                                    <input  name="age" type="text" class="form-control" id="age" value="{{ item.age }}" required="">
                                                                    <div class="invalid-feedback">
                                                                        Valid Name is required.
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-5">
                                                                    <label for="lastName">学历</label>
                                                                    <input  name="edu" type="text" class="form-control" id="edu" value="{{ item.edu }}" required="">
                                                                    <div class="invalid-feedback">
                                                                         Valid Name is required.
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-top: 10px">
                                                                <div class="col-lg-5">
                                                                    <label>身高</label>
                                                                    <input name="height" type="number" class="form-control" id="height" required="">
                                                                    <div class="invalid-feedback">
                                                                        Valid Name is required.
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-5">
                                                                    <label for="lastName">体重</label>
                                                                    <input name="weight" type="number" class="form-control" id="weight" required="">
                                                                    <div class="invalid-feedback">
                                                                         Valid Name is required.
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row" style="margin-top: 10px">
                                                                <div class="col-lg-5">
                                                                    <label>左眼视力</label>
                                                                    <input name="left_sight" type="number" class="form-control" id="left_sight" required="">
                                                                    <div class="invalid-feedback">
                                                                        Valid Name is required.
                                                                    </div>
                                                                </div>
                                                                <div class="col-lg-5">
                                                                    <label for="lastName">右眼视力</label>
                                                                    <input name="right_sight" type="number" class="form-control" id="right_sight" required="">
                                                                    <div class="invalid-feedback">
                                                                         Valid Name is required.
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="row col-md-11" style="margin-top: 10px">
                                                                <label>体温</label>
                                                                <input name="temperature" type="number" class="form-control" id="temperature">
                                                                <div class="invalid-feedback">
                                                                  Valid Name is required.
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>


                                              <div class="modal-footer">
                                                  <span id="tip"> </span>
                                                <button id="close_form" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                                <button id="save_form" type="button" class="btn btn-primary">Save changes</button>
                                              </div>
                                            </div>
                                        </div>
                                    </div>

                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    <tfoot>
                    <tr>
                        <th>编号</th>
                        <th>姓名</th>
                        <th>性别</th>
                        <th>年龄</th>
                        <th>学历</th>
                        <th>入院时间</th>
                        <th>体重</th>
                        <th>身高</th>
                        <th>体温</th>
                        <th>右眼视力</th>
                        <th>左眼视力</th>
                        <th>是否被领养</th>
                    </tr>
                    </tfoot>
                    </table>
                        </div>

                    </div>
                        </div>
                    </div>
                </div>
    </div>
    {% include 'Manager/page.html' %}
    <script type="text/javascript">

        $(function(){
            $('#Modal').modal("hide");
            });
        function values(v1,v2,v3,v4,v5,v6,v7,v8,v9,v10,v11,v12){
            $('#num').val(v1);
            $('#name').val(v2);
            $('#enter_time').val(v3);
            $('#age').val(v4);
            $('#edu').val(v5);
            $('#height').val(v6);
            $('#weight').val(v7);
            $('#right_sight').val(v8);
            $('#left_sight').val(v9);
            $('#temperature').val(v10);
            $('#gender').val(v11);
            $('#Is_adopted').val(v12);
        }

        function getNowFormatDate(d) {
            var Y = d[0];
            var M = parseInt(d[1]);
            M = M < 10 ? '0' + M : M;
            var D = d[2]
            D = parseInt(D)<10 ? '0' + D : D;
            return Y + '-' + M + '-' + D
        }
        $('#close_form').click(function () {
                $('#height').val("")
                $('#weight').val("")
                $('#right_sight').val("");
                $('#left_sight').val("");
                $('#temperature').val("");
                $('#gender').val("");
            })
        $('#save_form').click(function () {
            var height = $('#height').val()
            var weight = $('#weight').val()
            var right_sight = $('#right_sight').val()
            var left_sight = $('#left_sight').val()
            var temperature = $('#temperature').val()
            var num = $('#num').val()
            var name = $('#name').val()
            var str = $('#enter_time').val()
            var numArr = str.match(/-?([1-9]\d*(\.\d*)*|0\.[1-9]\d*)/g)

            var enter_time = getNowFormatDate(numArr)
            console.log(enter_time)
            var edu = $('#edu').val()
            var age = $('#age').val()
            var gender = $('#gender').val()
            var Is_adopted = $('#Is_adopted').val()
            $.get('{% url  'Manager:manager_update_child'%}',{'num':num,'height':height,'weight':weight,
                'right_sight':right_sight,'left_sight':left_sight,'temperature':temperature,'name':name,'enter_time':enter_time,
                 'edu':edu,'age':age,'gender':gender,'Is_adopted':Is_adopted},function (data) {
                if (data == 'error'){
                    $('#tip').html("<span style='color:red'>Failure,Check your input</span>")
                }
                else{
                    $('#tip').html("<span style='color:green'>Success</span>")
                    window.location.reload()
                }
            })
    })

    </script>
{% endblock %}